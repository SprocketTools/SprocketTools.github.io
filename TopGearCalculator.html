<html>
  <head>
		<title>SprocketTools Gear Calculator</title>
		<link rel="stylesheet" href="https://use.typekit.net/oov2wcw.css">
		<link rel="icon" type="image/x-icon" href="SprocketToolsLogo.png">
		<link rel="stylesheet" href="stylesV3.css">
		<style>
		</style> 
  </head>
  <body>
	<h6 style="font-size: 0px;">The best Sprocket Tank Design powertrain calculator!  Removes all the guesswork from calculating your transmission and engine setups.</h6>
	<div class="navbar titlenavbar">
		<img src="SprocketToolsLogo.png"/>
		<a href="index.html">Home</a>
		<a class="active" href="TopGearCalculator.html">Gear Calculator</a>
		<!-- <a href="ContestsList.html">Contests</a> -->
		<!-- <a href="VehicleGenerator.html">Random Tank Picker</a> -->
		<a href="resources.html">Sprocket Guides</a>
		<a href="credits.html">Credits</a>
		<a href="https://www.youtube.com/watch?v=kCq2sT6z9i4">Free Flyout Download</a>
		<a href="DecalsFeatured.html">Decal Catalog</a>
		<a href="PaintsFeatured.html">Paint Catalog</a>
        <a href="DecalsRGBmaker.html">RGB Decal Maker</a>
	</div>
	
	<div>
		<center>
			<h1>SprocketTools Gear Calculator</h1>	
			<h3>Enter your tank's info and watch the numbers appear!</h3>
		</center>
	</div>
	<div class="wrap" onclick="Calculate()">
		<div class="wrap">
			
			<div>
				<div class="box box200 box210h">
					<h3>Vehicle Era</h3>
					<div class="radio">
						<label  for="WWI"></label>
						<input  type="radio" id="WWI" name="era" value="WWI" />
						WWI</label>
					</div>
					<div class="radio"><label for="Interwar"></label>
						<input type="radio" id="Interwar" name="era" value="Interwar" />
						Interwar</label>
					</div>
					<div class="radio"><label for="Earlywar"></label>
						<input type="radio" id="Earlywar" name="era" value="Earlywar" />
						Earlywar</label>
					</div>
					<div class="radio"><label for="Midwar"></label>
						<input type="radio" id="Midwar" name="era" value="Midwar" />
						Midwar</label>
					</div>
					<div class="radio"><label for="Latewar"></label>
						<input type="radio" id="Latewar" name="era" value="Latewar" checked="checked"/>
						Latewar</label>
					</div>
					<div class="radio"><label for="Latewar"></label>
						<input type="radio" id="Custom" name="era" value="Custom"/>
						Custom</label>
					</div>
				</div>
				<div class="box box200 box120h tooltip" data-title="Enter the total weight of the vehicle in tons">
					<h3>Vehicle Weight (T)</h3>
					<input class="numberIn" type="number" min="1" step="1" value="28" id="Weight">
				</div>
				<div class="box box200 box120h tooltip" id="advanced_settings_invert1" data-title="Use the per-cylinder volume, not the total engine volume">
					<h3>Cylinder Size (L)</h3>
					<input class="numberIn" type="number" min="0.01" step="0.01" value="2.4" id="perCylDisp">
				</div>
				<div class="box box200 box120h"  id="advanced_settings_invert2">
					<h3>Cylinder Count</h3>
					<input class="numberIn" type="number" min="2" step="2" value="6" id="Cylind">
				</div>

			</div>
			<div>
				<div class="box box200 box210h">
					<h3>Transmission Type</h3>
					<div class="radio tooltip" data-title="Clutch Braking prefers higher downshift RPMs">
						<input  type="radio" id="1" name="style" value="0.8" checked="checked" />
						<label for="1">Clutch Braking</label>
					</div>
					<div class="radio tooltip"  data-title="Twin Transmissions prefer bigger starting gears.  IMPORTANT: Match R1 to G1">
						<input type="radio" id="2" name="style" value="1.25" />
						<label for="2">Twin Tramsmission</label>
					</div>
					<h3>Tuning Style</h3>
					<div class="radio tooltip" data-title="Slow turning can be fixed with stronger engines, bigger gears, or matching G1 & R1">
					<form>
						<input type="checkbox" id="fixturn" name="tuning1">
						<label for="tuning1"> Fix <b>Slow Turning</b></label><br>
						<input type="checkbox" id="bestspeed" name="tuning2" checked>
						<label for="tuning2"> Best <b>Top Speed</b><br>
					</form>
					</div>
				</div>
				<div class="box box200 box120h">
					<h3>Gear Count</h3>
					<input class="numberIn" type="number" min="1" max="24" step="1" value="6" id="GearCount">
				</div>
				<div class="box box200 box120h tooltip" data-title="Find this by right-clicking the Sprocket wheel">
					<h3>Sprocket Diameter</h3>
					<input class="numberIn" type="number" min="0.01" step="0.01" value="0.6" id="Diameter">
				</div>
				<!-- <div class="box boxcrimson box200 box60h">
					<h3>Advanced Mode <input type="checkbox" id="show_advanced_settings"></h3>
				</div> -->
				<div class="box box200 box120h">
					<h5></h5>
					<input type="submit" value="Contest Mode" class="button buttonsmall" id="show_advanced_settings">
					<input type="submit" value="  Extra Help  " class="button buttonsmall buttonblue" id="show_help_panel">
				</div>
			</div>
			
				<div id="advanced_settings_wrap">
					<!-- <div class="box boxcrimson box200 box120h">
						<h3>Max HP (not KW)</h3>
						<input class="numberIn" type="number" min="1" step="1" value="420" id="horsepower">
					</div> -->
					<div class="box boxcrimson box200 box120h" id="advanced_settings_1"  style="display: none;">
						<h3>Climb angle</h3>
						<input class="numberIn" type="number" min="1" step="1" max="90" value="80" id="ClimbAngle">
					</div>
					<div class="box boxcrimson box200 box120h" id="advanced_settings_2"  style="display: none;">
						<h3>Upshift RPM</h3>
						<input class="numberIn" type="number" min="0" step="50" value="2700" id="upshiftRPM">
					</div>
					<!-- <div class="box boxcrimson box200 box120h">
						<h3>Max HP (not KW)</h3>
						<input class="numberIn" type="number" min="1" step="1" value="420" id="horsepower">
					</div> -->
					<div class="box boxcrimson box200 box120h" id="custom_settings_1" style="display: none;">
						<h3>Roll Resistence</h3>
						<input class="numberIn" type="number" min="0" step="0.05" max="8.0" value="1.0" id="RollResist">
					</div>
					<div class="box boxcrimson box200 box120h" id="custom_settings_2" style="display: none;">
						<h3>Engine Tech</h3>
						<input class="numberIn" type="number" min="0" step="0.01" max="1.0" value="0.8" id="EngineTech">
					</div>
				</div>
			<div class="box box300">
				<h4 id="printlist2"></h4>
				<h4 id="topspeed"></h4>	
			</div>
			<div id="help_panel_wrap" style="display: none;">
				<div class="box boxblue boxmax300" >
					<h3>Running into issues with the calculator?</h3>
					<p style="text-align: left;">The <b>SprocketTools Gear Calculator</b> is designed to support as many vehicles as possible, but sometimes it can use extra tuning.</p>
					<ul style="text-align: left;">
						<li><b>Increase your first gears</b> if you have trouble accelerating or turning</li>
						<li><b>Match your G1 and R1</b> to prevent turning issues with twin transmissions</li>
						<li><b>Decrease your upshift slightly</b> if your vehicle gets stuck on a gear</li>
						<li><b>Check idler and Sprocket clearance</b> to ensure they aren't hitting the ground.</li>
						<li><b>Make your torsion bars longer</b> if your vehicle slows down on rough terrain.</li>
					</ul>
				</div>
			</div>
		</div>
		</div>
	</div>
	<script>


		function manageUrlParameters() {
			try {
				const currentUrlParams = new URLSearchParams(window.location.search);
				const newUrlParams = new URLSearchParams();

				// 2. Iterate through all existing parameters and append them to the new set
				for (const [key, value] of currentUrlParams.entries()) {
					if (key == "era") {
						var eras = document.getElementsByName('era');
						for(var i = 0; i < eras.length; i++){
							if(eras[i].value == value){
								eras[i].checked = true;
							}
							else {
								eras[i].checked = false;
							}
						}
					}
					if (key == "climbangle") {
						document.getElementById("ClimbAngle").value = value;
					}
				}

				// 3. Add any new parameters or modify existing ones
				// Example: Add a new parameter "source" or set an existing one
				if (!newUrlParams.has('source')) {
					newUrlParams.set('source', 'github-pages-script');
				}

				// 4. Construct the new URL string
				const newSearchString = newUrlParams.toString();
				const newUrl = window.location.pathname + '?' + newSearchString + window.location.hash;

				// 5. Update the browser URL without reloading the page
				// Use history.pushState or history.replaceState for single-page applications
				// Use this if you don't want a new history entry
				// or
				// Use location.assign(newUrl) to reload the page with new parameters
				//window.location.assign(newUrl);

			} catch (error) {
				// Handle any potential errors (e.g., if URL parsing fails in very old browsers)
				console.error("An error occurred while managing URL parameters:", error);
				// You could also redirect to an error page or show a fallback UI
			}
		}

		// Call the function when the page loads
		document.addEventListener('DOMContentLoaded', manageUrlParameters);

			// 		const currentUrlParams = new URLSearchParams(window.location.search);
			// const newUrlParams = new URLSearchParams();

			// if (advancedMode == true || customEraMode == true) {
			// 	newUrlParams.set('era', era);
			// }
			// if (advancedMode == true) {
			// 	newUrlParams.set('climbangle', Angle);
			// 	newUrlParams.set('upshift', L);
			// }
			// if (customEraMode == true) {
			// newUrlParams.set('rr', R);
			// newUrlParams.set('eng', eT);
			// }

		Calculate()

		

		function Calculate() {
			var foo = document.getElementById('printlist2');
			while (foo.firstChild) foo.removeChild(foo.firstChild);
			let cylinderCount = document.getElementById('Cylind').value;
			var eras = document.getElementsByName('era');
			var era = 'Latewar';
			for(var i = 0; i < eras.length; i++){
				if(eras[i].checked){
					era = eras[i].value;
				}
			}
			
			let R = 2;
			let eraBaseRPM = 3000;
			eraPowerMod = 1;
			if(era == 'WWI'){
				R = 4;
				eraBaseRPM = 1500;
				eraPowerMod = 0.2333;
			}
			if(era == 'Interwar'){
				R = 3;
				eraBaseRPM = 2700;
				eraPowerMod = 0.586;
			}
			if(era == 'Earlywar'){
				R = 1.5;
				eraBaseRPM = 3100;
				eraPowerMod = 0.72;
			}
			if(era == 'Midwar'){
				R = 1.25;
				eraBaseRPM = 3800;
				eraPowerMod = 0.92;
			}
			if(era == 'Latewar'){
				R = 1.0;
				eraBaseRPM = 4000;
				eraPowerMod = 1.00;
			}
			let eT = document.getElementById('EngineTech').value;
			if(era == 'Custom'){
				R = document.getElementById('RollResist').value;
				eraPowerMod = (2455 * (eT ** 0.395) + 625 * eT + 925) / 4000;
				eraBaseRPM = Math.round((4100 - 850) * (eraPowerMod ** 1.1) + 850)
			}
			
			const customEraMode = document.getElementById('custom_settings_1').checkVisibility();
		
			//setup for tuning style
			var styles = document.getElementsByName('style');
			var styleStr = '1';
			for(var i = 0; i < styles.length; i++){
				if(styles[i].checked){
					styleStr = styles[i].value;
				}
			}
			let styleVal = Number(styleStr)

			//variables
			var checkBox = false;
			var legacyFormula = false;
			let W = document.getElementById('Weight').value;
			let S = document.getElementById('Diameter').value;
			let Angle = document.getElementById('ClimbAngle').value;
			let perCylDisp = document.getElementById('perCylDisp').value;
			let H = cylinderCount*40*eraPowerMod*(Math.pow(perCylDisp, 0.7));
			let L = Math.round(eraBaseRPM * (perCylDisp ** -0.3) * 1.112);
			
			const advancedMode = document.getElementById('advanced_settings_1').checkVisibility();

			if (advancedMode == true){ //Equations to guess the HP by the given values
				let xin = document.getElementById('upshiftRPM').value / L
				L = document.getElementById('upshiftRPM').value;
				let hpmult = -6.7165 * xin**6 + 18.2036 * xin**5 - 18.0812 * xin**4 + 6.8847 * xin**3 + 0.3030 * xin**2 + 0.4131 * xin - 0.0063;
				H = Math.round(H * hpmult);
			}


			const bestSpeed = document.getElementById('bestspeed').checked;
			if (bestSpeed == false) {
				H = H-(H*0.1)
			}

			const slowturn = document.getElementById('fixturn').checked;
			let gear1mult = styleVal;
			if (slowturn == true) {
				gear1mult = gear1mult * 1.5;
			}
			


			let TopSpeed = (13.666 * (H ** 0.501) ) / ( (R ** 0.8) * (W ** 0.5) );
			TopSpeed = Math.round(10*TopSpeed)/10
			const topspeedprintout = document.createElement("h4");
			

			const topspeednode = document.createTextNode("Your top speed is " + TopSpeed + " km/h");
			topspeedprintout.className = "gearcalc-printout";
			topspeedprintout.appendChild(topspeednode);
			document.getElementById("printlist2").appendChild(topspeedprintout);
			
			const topspeedprintouttwo = document.createElement("h4");
			const topspeednodetwo = document.createTextNode("Equivalent to " + Math.round(TopSpeed*6.213712)/10 + " mph");
			topspeedprintouttwo.className = "gearcalc-printout";
			topspeedprintouttwo.appendChild(topspeednodetwo);
			document.getElementById("printlist2").appendChild(topspeedprintouttwo);
			
			let FinalGear = (60*3.14159*L*S*10) / (12.5*10000*TopSpeed);
			FinalGear = Math.round(100*FinalGear)/100;
			let Torque = (9.5492/L)*746*H;
			let Gear1 = Math.round(11*( (S/2)*(1000*W)*9.81*Math.sin(3.14*Angle/180) )/Torque)/100*gear1mult;
			if (Gear1 > 20 && Gear1 < 32.5){
				Gear1 = 20;
			}
			if(checkBox.checked == true){
				Gear1 = Math.round(Gear1*112)/100;
			}
			let GearCount = document.getElementById('GearCount').value;
			if(GearCount > 1600){
				window.open("https://www.youtube.com/watch?v=dCO89JvatxQ");
			}
			const gear1printout = document.createElement("h4");
			gear1printout.setAttribute("id", "gear1");
			const gear1node = document.createTextNode("Gear 1 is ");
			gear1printout.appendChild(gear1node);
			document.getElementById("printlist2").appendChild(gear1printout);

			para = document.createElement("span");
			node = document.createTextNode("" + Gear1.toFixed(2));
			para.appendChild(node);
			para.style.color = "var(--tan2)";
			document.getElementById("gear1").appendChild(para);
			let RatIn = Math.pow((Gear1/FinalGear), (1/(Math.pow((GearCount), 1.25))));
			let R2 = (Gear1/FinalGear)/GearCount;
			G2 = Gear1/R2;
			let RN = ((FinalGear/G2) ** (1/(GearCount - 2)));
			let gear_print = 0;
			let kvalue = Math.log(Gear1/FinalGear/RatIn)/Math.log(GearCount/RatIn); // determines the value for later

			// if (legacyFormula.checked == true){
			// 	for (let i = 2; i < GearCount; i++) {
			// 		gear_print = G2*((FinalGear/G2)**((i-2)/(GearCount-2)));
					
			// 		para = document.createElement("h4");
			// 		gear_print = Math.round(100*gear_print)/100;
			// 		node = document.createTextNode("Gear " + i + " is " + gear_print.toFixed(2));
			// 		para.setAttribute("id", "gear" + i);
			// 		para.appendChild(node);
			// 		document.getElementById("printlist2").appendChild(para);

			// 	}
			// 	para = document.createElement("h4");
			// 	node = document.createTextNode("Gear " + GearCount + " is ");
			// 	para.setAttribute("id", "gear" + GearCount);
			// 	para.appendChild(node);
			// 	document.getElementById("printlist2").appendChild(para);

			// 	para = document.createElement("span");
			// 	node = document.createTextNode("" + FinalGear.toFixed(2));
			// 	para.appendChild(node);
			// 	para.style.color = "orange";
			// 	document.getElementById("gear" + i).appendChild(para);	
			// }
			//else{
				
			for (let i = 2; i < GearCount; i++) {
				gear_print = Gear1/((Math.pow(RatIn, (1-kvalue)))*Math.pow(i, kvalue));
				
				para = document.createElement("h4");
				para.setAttribute("id", "gear" + i);
				gear_print = Math.round(100*gear_print)/100;
				node = document.createTextNode("Gear " + i + " is ");
				para.appendChild(node);
				document.getElementById("printlist2").appendChild(para);

				para = document.createElement("span");
				node = document.createTextNode("" + gear_print.toFixed(2));
				para.appendChild(node);
				para.style.color = "var(--tan2)";
				document.getElementById("gear" + i).appendChild(para);	
			}
			para = document.createElement("h4");
			node = document.createTextNode("Gear " + GearCount + " is ");
			para.setAttribute("id", "gear" + GearCount);
			para.appendChild(node);
			document.getElementById("printlist2").appendChild(para);

			para = document.createElement("span");
			node = document.createTextNode("" + FinalGear.toFixed(2));
			para.appendChild(node);
			para.style.color = "var(--tan2)";
			document.getElementById("gear" + GearCount).appendChild(para);

			const currentUrlParams = new URLSearchParams(window.location.search);
			const newUrlParams = new URLSearchParams();

			if (advancedMode == true || customEraMode == true) {
				newUrlParams.set('era', era);
			}
			if (advancedMode == true) {
				newUrlParams.set('climbangle', Angle);
				newUrlParams.set('upshift', L);
			}
			if (customEraMode == true) {
			newUrlParams.set('rr', R);
			newUrlParams.set('eng', eT);
			}

			const newSearchString = newUrlParams.toString();
			const newUrl = window.location.pathname + '?' + newSearchString + window.location.hash;
			history.replaceState({}, '', newUrl);
			//}

			if (document.getElementById('show_advanced_settings').checked == false){
				let idealRPM = Math.round(eraBaseRPM * (perCylDisp ** -0.3) * 1.01)
				let Gear2_final = Gear1/((Math.pow(RatIn, (1-kvalue)))*Math.pow(2, kvalue))
				let downRPM = Math.round(idealRPM / (Gear1 / (Gear2_final)) / styleVal * 1.4)

				

				// para = document.createElement("h5");
				// node = document.createTextNode("Estimated RPM limit: " + L + " RPM");

				// para.appendChild(node);
				// document.getElementById("printlist2").appendChild(para);

				para = document.createElement("h4");
				node = document.createTextNode("Set your upshift to ");
				para.setAttribute("id", "gearUpshift");
				para.appendChild(node);
				document.getElementById("printlist2").appendChild(para);

				para = document.createElement("span");
				node = document.createTextNode(idealRPM + " RPM");
				para.appendChild(node);
				para.style.color = "orange";
				document.getElementById("gearUpshift").appendChild(para);

				para = document.createElement("h4");
				node = document.createTextNode("Set your downshift to ");
				para.setAttribute("id", "gearDownshift");
				para.appendChild(node);
				document.getElementById("printlist2").appendChild(para);

				para = document.createElement("span");
				node = document.createTextNode(downRPM + " RPM");
				para.appendChild(node);
				para.style.color = "orange";
				document.getElementById("gearDownshift").appendChild(para);
			}
			else {
				para = document.createElement("h5");
				node = document.createTextNode("Estimated horsepower: " + Math.round(H) + "HP");

				para.appendChild(node);
				document.getElementById("printlist2").appendChild(para);
			}


		}




		const checkbox = document.getElementById('show_advanced_settings');
		const element = document.getElementById('advanced_settings_wrap');

		const elements = document.getElementsByName('era');
		const element0 = document.getElementById('advanced_settings_1');
		const element1 = document.getElementById('advanced_settings_2');
		const element2 = document.getElementById('advanced_settings_invert1');
		const element3 = document.getElementById('advanced_settings_invert2');
		const element5 = document.getElementById('custom_settings_1');
		const element6 = document.getElementById('custom_settings_2');

		var advancedMode = false;
		var advancedMode2 = false;

		checkbox.addEventListener('click', function() {
			advancedMode = !advancedMode
			if (advancedMode == true) {
				element0.style.display = 'inherit';
				element1.style.display = 'inherit';
				//element2.style.display = 'none';
				//element3.style.display = 'none';
			} else {
				//element2.style.display = 'none';
				//element3.style.display = 'none';
				element0.style.display = 'none';
				element1.style.display = 'none';
			}
		})
		elements.forEach(eraradio => {
			eraradio.addEventListener('change', function() {
				var eras = document.getElementsByName('era');
				var era = 'Latewar';
				for(var i = 0; i < eras.length; i++){
					if(eras[i].checked){
						era = eras[i].value;
					}
				}
				advancedMode2 = !advancedMode2
				if (era == "Custom") {
					element6.style.display = 'inherit';
					element5.style.display = 'inherit';
				} else {
					element6.style.display = 'none';
					element5.style.display = 'none';

				}
			})
		});
		const checkbox2 = document.getElementById('show_help_panel');
		const element4 = document.getElementById('help_panel_wrap');
		var helpPanel = false;
		checkbox2.addEventListener('click', function() {
			helpPanel = !helpPanel
			if (helpPanel == true) {
				element4.style.display = 'inline-block';
			} else {
				element4.style.display = 'none';
			}
		});
	</script>
  </body>
</html>